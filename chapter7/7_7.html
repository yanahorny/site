<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=windows-1251">
		<meta name="Description" content="K&R, 1st ed., 1978. Russian translation by <unknown>; chm-compiling by Sim&C, Belarus`2006">
   		<title>7.7 Обработка ошибок - stderr и exit</title>
		<link href="../style.css" rel="stylesheet" type="text/css" media="all">
	</head>

	<body>
	<script  language=JavaScript  src="../header.js"></script>
	<pre>    Обработка ошибок в cat неидеальна. Неудобство заключает-
ся в том, что если один из файлов по некоторой причине ока-
зывается недоступным, диагностическое сообщение об этом пе-
чатается в конце объединенного вывода. Это приемлемо, если
вывод поступает на терминал, но не годится, если вывод пос-
тупает в некоторый файл или через поточный (pipeline) меха-
низм в другую программу.
    Чтобы лучше обрабатывать такую ситуацию, к программе
точно таким же образом, как stdin и stdout, присоединяется
второй выходной файл, называемый stderr. Если это вообще
возможно, вывод, записанный в файле stderr, появляется на
терминале пользователя, даже если стандартный вывод направ-
ляется в другое место.
    Давайте переделаем программу cat таким образом, чтобы
сообщения об ошибках писались в стандартный файл ошибок.

&quot;include  &lt;stdio.h&gt;

main(argc,argv)  /*cat: concatenate files*/
int argc;
char *argv[];
{
  FILE *fp, *fopen();
  if(argc==1)  /*no args; copy standard input*/
    filecopy(stdin);
  else
    while (--argc &gt; 0)
      if((fp=fopen(*++argv,&quot;r#))==NULL) {
      fprintf(stderr, &quot;cat: can't open,%s\n&quot;, argv);
      exit(1);
    }
    else {
      filecopy(fp);
    }
  exit(0);
}

Программа сообщает об ошибках двумя способами. Диагностичес-
кое сообщение, выдаваемое функцией fprintf, поступает в
stderr и, таким образом, оказывается на терминале пользова-
теля, а не исчезает в потоке (pipeline) или в выходном фай-
ле.
    Программа также использует функцию exit из стандартной
библиотеки, обращение к которой вызывает завершение выполне-
ния программы. Аргумент функции exit доступен любой програм-
ме, обращающейся к данной функции, так что успешное или неу-
дачное завершение данной программы может быть проверено дру-
гой программой, использующей эту в качестве подзадачи. По
соглашению величина 0 в качетсве возвращаемого значения сви-
детельствует о том, что все в порядке, а различные ненулевые
значения являются признаками ненормальных ситуаций.
    Функция exit вызывает функцию fclose для каждого откры-
того выходного файла, с тем чтобы вывести всю помещенную в
буферы выходную информацию, а затем вызывает функцию _exit.
Функция _exit приводит к немедленному завершению без очистки
каких-либо буферов; конечно, при желании к этой функции мож-
но обратиться непосредственно.</pre>
	<script  language=JavaScript  src="../footer.js"></script>
	</body>
	
</html>