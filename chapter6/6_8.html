<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=windows-1251">
		<meta name="Description" content="K&R, 1st ed., 1978. Russian translation by <unknown>; chm-compiling by Sim&C, Belarus`2006">
   		<title>6.8 Объединения</title>
		<link href="../style.css" rel="stylesheet" type="text/css" media="all">
	</head>

	<body>
	<script  language=JavaScript  src="../header.js"></script>
	<pre>    Oбъединения - это переменная, которая в различные момен-
ты времени может содержать объекты разных типов и размеров,
причем компилятор берет на себя отслеживание размера и тре-
бований выравнивания. Объединения представляют возможность
работать с различными видами данных в одной области памяти,
не вводя в программу никакой машинно-зависимой информации.
    В качестве примера, снова из символьной таблицы компиля-
тора, предположим, что константы могут быть типа int, float
или быть указателями на символы. Значение каждой конкретной
константы должно храниться в переменной соотвествующего ти-
па, но все же для управления таблицей самым удобным было бы,
если это значение занимало бы один и тот же объем памяти и
хранилось в том же самом месте независимо от его типа. Это и
является назначением объединения - выделить отдельную пере-
менную, в которой можно законно хранить любую одну из пере-
менных нескольких типов. Как и в случае полей, синтаксис ос-
новывается на структурах.

union u_tag {
  int ival;
  float fval;
  char *pval;
} uval;

Переменная uval будет иметь достаточно большой размер,чтобы
хранить наибольший из трех типов, независимо от машины, на
которой осуществляется компиляция, - программа не будет за-
висить от характеристик аппаратных средств. Любой из этих
трех типов может быть присвоен uvar и затем использован в
выражениях, пока такое использование совместимо: извлекаемый
тип должен совпадать с последним помещенным типом. Дело
программиста - следить за тем, какой тип хранится в объеди-
нении в данный момент; если что-либо хранится как один тип,
а извлекается как другой, то результаты будут зависеть от
используемой машины.
    Синтаксически доступ к членам объединения осуществляется
следующим образом:

  имя объединения.член
  --------------------
или
  указатель объединения -&gt;член
  ----------------------------

то есть точно так же, как и в случае структур. Если для отс-
леживания типа, хранимого в данный момент в uval, использу-
ется переменная utype, то можно встретить такой участок
программы:

if (utype == INT)
  printf(&quot;%d\n&quot;, uval.ival);
else if (utype == FLOAT)
  printf(&quot;%f\n&quot;, uval.fval);
else if (utype == STRING)
  printf(&quot;%s\n&quot;, uval.pval);
else
  printf(&quot;bad type %d in utype\n&quot;, utype);

    Объединения могут появляться внутри структур и массивов
и наоборот. Запись для обращения к члену объединения в
структуре (или наоборот) совершенно идентична той, которая
используется во вложенных структурах. Например, в массиве
структур, определенным следующим образом

struct {
  char *name;
  int flags;
  int utype;
  union {
    int ival;
    float fval;
    char *pval;
  } uval;
} symtab[nsym];

на переменную ival можно сослаться как

  symtab[i].uval.ival

а на первый символ строки pval как

  *symtab[i].uval.pval

   В сущности объединение является структурой, в которой все
члены имеют нулевое смещение. Сама структура достаточно ве-
лика, чтобы хранить &quot;самый широкий&quot; член, и выравнивание
пригодно для всех типов, входящих в объединение. Как и в
случае структур, единственными операциями, которые в настоя-
щее время можно проводить с объединениями, являются доступ к
члену и извлечение адреса; объединения не могут быть присво-
ены, переданы функциям или возвращены ими. Указатели объеди-
нений можно использовать в точно такой же манере, как и ука-
затели структур.
   Программа распределения памяти, приводимая в главе 8,
показывает, как можно использовать объединение, чтобы сде-
лать некоторую переменную выровненной по определенному виду
границы памяти.
</pre>
	<script  language=JavaScript  src="../footer.js"></script>
	</body>
	
</html>
