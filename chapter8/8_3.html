<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=windows-1251">
		<meta name="Description" content="K&R, 1st ed., 1978. Russian translation by <unknown>; chm-compiling by Sim&C, Belarus`2006">
   		<title>8.3 Открытие, создание, закрытие и расцепление (unlink)</title>
		<link href="../style.css" rel="stylesheet" type="text/css" media="all">
	</head>

	<body>
	<script  language=JavaScript  src="../header.js"></script>
	<pre>

    Кроме случая, когда по умолчанию определены стандартные
файлы ввода, вывода и ошибок, вы должны явно открывать фай-
лы, чтобы затем читать из них или писать в них. Для этой це-
ли существуют две точки входа: open и creat.
    Функция open весьма сходна с функцией fopen, рассмотрен-
ной в главе 7, за исключением того, что вместо возвращения
указателя файла она возвращает дескриптор файла, который яв-
ляется просто целым типа int.

int fd;
fd=open(name,rwmode);

Как и в случае fopen, аргумент name является символьной
строкой, соответствующей внешнему имени файла. Однако аргу-
мент, определяющий режим доступа, отличен: rwmode равно: 0 -
для чтения, 1 - для записи, 2 - для чтения и записи. Если
происходит какая-то ошибка, функция open возвращает "-1"; в
противном случае она возвращает действительный дескриптор
файла.
    Попытка открыть файл, который не существует, является
ошибкой. Точка входа creat предоставляет возможность созда-
ния новых файлов или перезаписи старых. В результате обраще-
ния

fd=creat(name,pmode);

возвращает дескриптор файла, если оказалось возможным соз-
дать файл с именем name, и "-1" в противном случае. Если
файл с таким именем уже существует, creat усечет его до ну-
левой длины; создание файла, который уже существует, не яв-
ляется ошибкой.
    Если файл является совершенно новым, то creat создает
его с определенным режимом защиты, специфицируемым аргумен-
том pmode. В системе файлов на UNIX с файлом связываются де-
вять битов защиты информации, которые управляют разрешением
на чтение, запись и выполнение для владельца файла, для
группы владельцев и для всех остальных пользователей. Таким
образом, трехзначное восьмеричное число наиболее удобно для
спецификации разрешений. Например, число 0755 свидетельству-
ет о разрешении на чтение, запись и выполнение для владельца
и о разрешении на чтение и выполнение для группы и всех ос-
тальных.
    Для иллюстрации ниже приводится программа копирования
одного файла в другой, являющаяся упрощенным вариантом ути-
литы CP системы UNIX. (Основное упрощение заключается в том,
что наш вариант копирует только один файл и что второй аргу-
мент не должен быть справочником).

#define NULL 0
#define BUFSIZE 512
#define PMODE 0644 /*rw for owner,r for group,others*/
main(argc,argv) /*cp: copy f1 to f2*/
int argc;
char *argv[];
{
  int f1, f2, n;
  char buf[BUFSIZE];
  if (argc ! = 3)
  error("usage:cp from to", null);
  if ((f1=open(argv[1],0))== -1)
    error("cp:can't open %s", argv[1]);
  if ((f2=creat(argv[2],pmode))== -1)
    error("cp: can't create %s", argv[2]);
  while ((n=read(f1,buf,BUFSIZE))>0)
    if (write(f2,buf,n) != n)
      error("cp: write error", NULL);
  exit(0);
}
   
error(s1,s2) /*print error message and die*/
char *s1, s2;
{
  printf(s1,s2);
  printf("\n");
  exit(1);
}

    Существует ограничение (обычно 15 - 25) на количество
файлов, которые программа может иметь открытыми одновремен-
но. В соответствии с этим любая программа, собирающаяся ра-
ботать со многими файлами, должна быть подготовлена к пов-
торному использованию дескрипторов файлов. Процедура close
прерывает связь между дескриптором файла и открытым файлом и
освобождает дескриптор файла для использования с некоторым
другим файлом. Завершение выполнения программы через exit
или в результате возврата из ведущей программы приводит к
закрытию всех открытых файлов.
    Функция расцепления unlink (filename) удаляет из системы
файлов файл с именем filename (из данного справочного фай-
ла. Файл может быть сцеплен с другим справочником, возможно,
под другим именем - примеч.переводчика).

Упражнение 8-1
    Перепишите программу cat из главы 7, используя функции
read, write, open и close вместо их эквивалентов из стандар-
тной библиотеки. Проведите эксперименты для определения от-
носительной скорости работы этих двух вариантов.
</pre>
	<script  language=JavaScript  src="../footer.js"></script>
	</body>
	
</html>
